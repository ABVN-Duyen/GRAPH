sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/suite/ui/microchart/ComparisonMicroChart","sap/suite/ui/microchart/ComparisonMicroChartData","sap/m/MessageBox","sap/m/MessageToast","sap/ui/export/Spreadsheet","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,n,i,o,s,l,r,u){var D=new t(sap.ui.require.toUrl("project1/graph.json"));let p;let E;var f;var S;var I;var c;var T;var N;var d=0;var h=0;var g=0;var R;var A;var C;var O;var v=D.oData.input;var y;var U;var m="Standard";var L="";var b="";var w="TESTING";var _=0;var x="sapUiResponsivePadding--header sapUiResponsivePadding--content sapUiResponsivePadding--footer";var H=e.extend("project1.view.NetworkGraph",{onInit:function(){p=" ";E=false;U=this.getOwnerComponent().getModel();this.getView().setModel(D);D.setSizeLimit(2e3);this._oModelSettings=new t({source:"atomicCircle",orientation:"LeftRight",arrowPosition:"End",arrowOrientation:"ParentOf",nodeSpacing:55,mergeEdges:false});this.getView().setModel(this._oModelSettings,"settings");var e="/graph/getInput()";$.ajax({url:e,type:"GET",method:"GET",success:function(e,t,a){f=e.value;console.log(e);D.refresh();if(f.length<1){i.error("Client has no data")}}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});this.get_client_from_inputview()},get_client:function(e){let t=this.getView().getModel();for(var a=0;a<e.length;a++){var n=`/graph/get_client(client='${e[a].CLIENT}')`;let i=this;$.ajax({url:n,type:"GET",method:"GET",success:function(e,a,n){N=e.value;console.log(N);for(var i=0;i<N.length;i++){t.oData.client.push({CLIENTKEY:N[i].CLIENTKEY,MATRIX:N[i].MATRIX,CHART:N[i].MATRIX,TITLE:N[i].TITLE})}}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});t.refresh()}},get_client_from_inputview:function(){let e=this.getView().getModel();var t="/graph/get_client_from_inputview()";let a=this;$.ajax({url:t,type:"GET",method:"GET",success:function(e,t,n){N=e.value;a.get_client(N);console.log(e)}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});e.refresh()},fetchClients:function(){let e=this.getView().getModel();var t="/graph/getInput()";let a=this;$.ajax({url:t,type:"GET",method:"GET",success:function(e,t,a){f=e.value;console.log(e)}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});e.refresh()},onValueHelpRequest:function(e){D.oData.input=[];D.oData.groups=[];D.oData.lines=[];D.oData.nodes=[];E=false;p="";var t=e.getSource().getValue();oView=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=l.load({id:oView.getId(),name:"project1.view.ValueHelpDialog",controller:this}).then(function(e){oView.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.getBinding("items").filter([new r("CLIENTKEY",u.Contains,t)]);e.open(t)})},onValueHelpSearch:function(e){var t=e.getParameter("value");var a=new r("CLIENTKEY",u.Contains,t);e.getSource().getBinding("items").filter([a])},onValueHelpClose:function(e){E=false;p="";var t=e.getParameter("selectedItem");e.getSource().getBinding("items").filter([]);if(!t){return}this.byId("clientInput").setValue(t.getTitle());b=t.getTitle();for(let e=0;e<D.oData.client.length;e++){if(b==D.oData.client[e].CLIENTKEY){}}this.drawClientData(t.getTitle())},getInputF4:function(e){E=false;p="";var t=[];var a="Client ";b=e.getParameter("value");if(b==""){D.oData.input=[];D.oData.groups=[];D.oData.lines=[];D.oData.nodes=[]}this.drawClientData(b)},drawClientData:function(e){D.oData.input=[];for(var t=0;t<f.length;t++){if(f[t].CLIENT==e){D.oData.input.push({SOURCE:f[t].SOURCE,INDSOURCE:f[t].INDSOURCE,DESTINATION:f[t].DESTINATION,INDDEST:f[t].INDDEST,CLIENT:f[t].CLIENT,RELATIONSHIP:"",AREA:f[t].AREA,DESAREA:f[t].DESAREA,editable:false})}}if(D.oData.input.length!=0){D.refresh();this._drawGraph(D.oData.input);E=false}else{if(e!=""){i.error("Client has no data");D.oData.input=[]}D.refresh();E=false}},onBeforeRendering:function(){this.byId("ins").setModel(this.jModel)},onAfterRendering:function(){this.byId("graphWrapper").$().css("overflow-y","auto")},mergeChanged:function(e){this._oModelSettings.setProperty("/mergeEdges",!!Number(e.getSource().getProperty("selectedKey")))},spacingChanged:function(e){this._oModelSettings.setProperty("/nodeSpacing",Number(e.getSource().getProperty("selectedKey")))},addRow:function(e){d=1;if(R!=undefined){D.oData.input=[];d=1}if(p==""){D.oData.input.unshift({AREA:"",SOURCE:"",INDSOURCE:"",DESAREA:"",DESTINATION:"",INDDEST:"",RELATIONSHIP:"",editable:false,CLIENT:b})}else{D.oData.input.unshift({AREA:"",SOURCE:"",INDSOURCE:"",DESAREA:"",DESTINATION:"",INDDEST:"",RELATIONSHIP:"",editable:true,CLIENT:b})}D.refresh()},inputInit:function(e){var t=e.value;D.refresh();var a=new Set;var n=new Set;var i="Indicator ";var o="Node ";var s="Hypothesis ";D.oData.groups=[];D.oData.lines=[];D.oData.nodes=[];var l={};for(var r=0;r<t.length;r++){var u=t[r].SOURCE.toUpperCase();var p=t[r].INDSOURCE;var E=t[r].DESTINATION.toUpperCase();var f=t[r].INDDEST;var S=t[r].RELATIONSHIP;if(u!=""&&E!=""){if(D.oData.lines.includes({SOURCE:u,DESTINATION:E,status:m,lineType:"Solid"})){}console.log(l.entries);if(S){S=S.toLowerCase();switch(S){case"o":m="Success";break;case"x":m="Standard";break}for(var I=0;I<D.oData.lines.length;I++){if(D.oData.lines[I].SOURCE==u&&D.oData.lines[I].DESTINATION==E){D.oData.lines.splice(I,1);D.oData.input.splice(I,1);break}}D.oData.lines.push({SOURCE:u,DESTINATION:E,status:m,lineType:"Solid"})}if(!a.has(u)){D.oData.groups.push({key:u,title:s.concat(u)});D.oData.nodes.push({key:u,title:u,status:"Information",shape:"Box",group:u})}if(!a.has(E)){D.oData.groups.push({key:E,title:s.concat(E)});D.oData.nodes.push({key:E,title:E,status:"Information",shape:"Box",group:E})}if(p!=""&&!n.has(p)){D.oData.nodes.push({key:p,title:p,status:"",shape:"Box",group:u})}if(f!=""&&!n.has(f)){D.oData.nodes.push({key:f,destinationIn:f,status:"",shape:"Box",group:E})}if(u==""&&E!=""){D.oData.lines.push({SOURCE:E,DESTINATION:E,status:m,lineType:"Solid"})}if(u!=""&&E==""){D.oData.lines.push({SOURCE:u,DESTINATION:u,status:m,lineType:"Solid"})}a.add(u);a.add(E);n.add(p);n.add(f)}if(u==""||E==""){if(u!=""&&!a.has(u)){D.oData.groups.push({key:u,title:s.concat(u)});D.oData.nodes.push({key:u,title:u,status:"Information",shape:"Box",group:u})}if(E!=""&&!a.has(E)){D.oData.groups.push({key:E,title:s.concat(E)});D.oData.nodes.push({key:E,title:E,status:"Information",shape:"Box",group:E})}if(p!=""&&!n.has(p)){D.oData.nodes.push({key:p,title:p,status:"",shape:"Box",group:u})}if(f!=""&&!n.has(f)){D.oData.nodes.push({key:f,title:f,status:"",shape:"Box",group:E})}a.add(u);a.add(E);n.add(p);n.add(f)}}D.refresh()},inputFromChange:function(){if((c==1||h==2)&&g==0&&d==0){if(T==undefined){T=D.oData.input}else{var e=O[0];T[e].SOURCE=D.oData.input[0].SOURCE;T[e].DESTINATION=D.oData.input[0].DESTINATION;T[e].INDSOURCE=D.oData.input[0].INDSOURCE;T[e].INDDEST=D.oData.input[0].INDDEST;T[e].AREA=D.oData.input[0].AREA;T[e].DESAREA=D.oData.input[0].DESAREA;T[e].RELATIONSHIP=D.oData.input[0].RELATIONSHIP;if(p=="X"){D.oData.final[e].SOURCE=D.oData.input[0].SOURCE;D.oData.final[e].DESTINATION=D.oData.input[0].DESTINATION;D.oData.final[e].INDSOURCE=D.oData.input[0].INDSOURCE;D.oData.final[e].INDDEST=D.oData.input[0].INDDEST;D.oData.final[e].AREA=D.oData.input[0].AREA;D.oData.final[e].DESAREA=D.oData.input[0].DESAREA;D.oData.final[e].MATCH_FLAG=D.oData.input[0].RELATIONSHIP}}this._drawGraph(T);D.refresh();return}if((c==2||h==1)&&g==0&&d==0){if(T==undefined){T=D.oData.input}else{for(var t=0;t<D.oData.input.length;t++){var e=O[t];T[e].SOURCE=D.oData.input[t].SOURCE;T[e].DESTINATION=D.oData.input[t].DESTINATION;T[e].INDSOURCE=D.oData.input[t].INDSOURCE;T[e].INDDEST=D.oData.input[t].INDDEST;T[e].AREA=D.oData.input[t].AREA;T[e].DESAREA=D.oData.input[t].DESAREA;T[e].RELATIONSHIP=D.oData.input[t].RELATIONSHIP;if(p=="X"){D.oData.final[e].SOURCE=D.oData.input[t].SOURCE;D.oData.final[e].DESTINATION=D.oData.input[t].DESTINATION;D.oData.final[e].INDSOURCE=D.oData.input[t].INDSOURCE;D.oData.final[e].INDDEST=D.oData.input[t].INDDEST;D.oData.final[e].AREA=D.oData.input[t].AREA;D.oData.final[e].DESAREA=D.oData.input[t].DESAREA;D.oData.final[e].MATCH_FLAG=D.oData.input[t].RELATIONSHIP}}}this._drawGraph(T);D.refresh();return}if(g==1){if(T==undefined){T=D.oData.input}this._drawGraph(T);D.refresh();g=0;return}if(d==1){T=D.oData.input;T=[];let e=[];for(var t=0;t<D.oData.input.length;t++){T.push({SOURCE:D.oData.input[t].SOURCE,INDSOURCE:D.oData.input[t].INDSOURCE,DESTINATION:D.oData.input[t].DESTINATION,INDDEST:D.oData.input[t].INDDEST,RELATIONSHIP:D.oData.input[t].RELATIONSHIP,AREA:D.oData.input[t].AREA,DESAREA:D.oData.input[t].DESAREA,CLIENT:b});e.push({SOURCE:D.oData.input[t].SOURCE,INDSOURCE:D.oData.input[t].INDSOURCE,DESTINATION:D.oData.input[t].DESTINATION,INDDEST:D.oData.input[t].INDDEST,MATCH_FLAG:D.oData.input[t].RELATIONSHIP,NEW_FLAG:"",AREA:D.oData.input[t].AREA,DESAREA:D.oData.input[t].DESAREA,CLIENT:b,CLIENT_ITEM:"TESTING"})}if(p=="X"){for(let t=0;t<D.oData.final.length;t++){let a=D.oData.final[t];for(let t=0;t<e.length;t++){let n=e[t];if(a.SOURCE==n.SOURCE&&a.INDSOURCE==n.INDSOURCE&&a.DESTINATION==n.DESTINATION&&a.INDDEST==n.INDDEST){e.splice(t,1)}}}for(let t=0;t<e.length;t++){D.oData.final.push({SOURCE:e[t].SOURCE,INDSOURCE:e[t].INDSOURCE,DESTINATION:e[t].DESTINATION,INDDEST:e[t].INDDEST,MATCH_FLAG:e[t].RELATIONSHIP,NEW_FLAG:"O",AREA:e[t].AREA,DESAREA:e[t].DESAREA,CLIENT:b,CLIENT_ITEM:"TESTING"})}}D.oData.input=[];D.oData.input=T;this._drawGraph(T);D.refresh();d=0;return}if(p=="X"){D.oData.final=[];for(let e=0;e<D.oData.input.length;e++){D.oData.final.push({SOURCE:D.oData.input[e].SOURCE,INDSOURCE:D.oData.input[e].INDSOURCE,DESTINATION:D.oData.input[e].DESTINATION,INDDEST:D.oData.input[e].INDDEST,MATCH_FLAG:D.oData.input[e].RELATIONSHIP,NEW_FLAG:"",AREA:D.oData.input[e].AREA,DESAREA:D.oData.input[e].DESAREA,CLIENT:b,CLIENT_ITEM:"TESTING"})}}this._drawGraph(D.oData.input);D.refresh();return},_drawGraph:function(e){D.refresh();let t=[JSON.stringify(["人的資本への取組み","多様性の推進"]),JSON.stringify(["多様性の推進","多様な社員の獲得"]),JSON.stringify(["ZERO WASTE","LESS WASTE & MORE RECYCLE"]),JSON.stringify(["LESS WASTE & MORE RECYCLE","INCREASE OF RECYCLEING"])];let a=[JSON.stringify(["キャリア採用数","女性管理職比率"]),JSON.stringify(["女性管理職比率","社員の定着率"]),JSON.stringify(["社員の定着率","特許出願件数"]),JSON.stringify(["特許出願件数","ROE"]),JSON.stringify(["Industrial waste recycling rate","Number of press releases"]),JSON.stringify(["Number of press releases","Number of customers in open factory"]),JSON.stringify(["Number of customers in open factory","Sales amount"]),JSON.stringify(["Sales amount","PBR"]),JSON.stringify(["Sales amount","ROE"])];var n=new Set;var o=new Set;var s=new Set;m="ReleventNode";var l="Indicator ";var r="Box ";var u="Hypothesis ";var E,f;var S,I;let c=this.getView().byId("graphWrapper");let T=this.getView().byId("TabContainer");D.oData.groups=[];D.oData.lines=[];D.oData.nodes=[];var N=[];var d=false;D.oData.linetmp=[];for(var h=0;h<e.length;h++){S=e[h].AREA;I=e[h].DESAREA;if(S!=""){E="Group1"}else{E="Group2"}if(I!=""){f="Group1"}else{f="Group2"}e[h].SOURCE=e[h].SOURCE.toUpperCase();e[h].DESTINATION=e[h].DESTINATION.toUpperCase();var g=e[h].SOURCE.toUpperCase();var R=e[h].INDSOURCE;var A=e[h].DESTINATION.toUpperCase();var C=e[h].INDDEST;var O=e[h].RELATIONSHIP;var v=b;if(!A){A=""}if(!R){R=""}if(!C){C=""}if(S!=""&&R!=""){new sap.m.MessageBox.error("Cannot set Area for Source/Destination has Indicators",{title:"Alert",onClose:null,styleClass:"",actions:sap.m.MessageBox.Action.OK,emphasizedAction:sap.m.MessageBox.Action.OK,initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit});return}if(I!=""&&C!=""){new sap.m.MessageBox.error("Cannot set Area for Source/Destination has Indicators",{title:"Alert",onClose:null,styleClass:"",actions:sap.m.MessageBox.Action.OK,emphasizedAction:sap.m.MessageBox.Action.OK,initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit});return}if(g!=""&&A!=""){for(var y=0;y<D.oData.lines.length;y++){if(D.oData.lines[y].SOURCE==g&&D.oData.lines[y].DESTINATION==A){D.oData.lines.splice(y,1);break}}if(p==""){if(!t.includes(JSON.stringify([g,A]))){D.oData.lines.push({SOURCE:g,DESTINATION:A,CLIENT:v,status:"customLine",lineType:"Solid"});D.oData.linetmp.push({SOURCE:g,DESTINATION:A,status:"customLine",lineType:"Solid"})}else{D.oData.lines.push({SOURCE:g,DESTINATION:A,CLIENT:v,status:m,lineType:"Solid"});D.oData.linetmp.push({SOURCE:g,DESTINATION:A,status:m,lineType:"Solid"})}}if(!o.has(g)){if(S!=""){if(!n.has(S)){D.oData.groups.push({key:g,title:S,status:E,client:v});n.add(S)}D.oData.groups.forEach(e=>{if(e.title===S){D.oData.nodes.push({key:g,title:g,status:"Src_DesNode",shape:"Box",group:e.key,client:v})}})}else{D.oData.groups.push({key:g,title:S,status:E,client:v});D.oData.nodes.push({key:g,title:g,status:"Src_DesNode",shape:"Box",group:g,client:v})}N[g]=new Set;N[g].add(g)}if(!o.has(A)){if(I!=""){console.log(I);if(!n.has(I)){D.oData.groups.push({key:A,title:I,status:f,client:v});n.add(I)}D.oData.groups.forEach(e=>{if(e.title==I){console.log(e.key);D.oData.nodes.push({key:A,title:A,status:"Src_DesNode",shape:"Box",group:e.key,client:v})}})}else{D.oData.groups.push({key:A,title:I,status:f,client:v});D.oData.nodes.push({key:A,title:A,status:"Src_DesNode",shape:"Box",group:A,client:v})}N[A]=new Set;N[A].add(A)}if(R!=""&&!N[g].has(R)){D.oData.nodes.push({key:g.concat(R),title:R,status:"IndNode",shape:"Box",group:g,client:v});N[g].add(R)}if(C!=""&&!N[A].has(C)){D.oData.nodes.push({key:A.concat(C),title:C,status:"IndNode",shape:"Box",group:A,client:v});N[A].add(C)}if(g==""&&A!=""){D.oData.lines.push({SOURCE:A,DESTINATION:A,CLIENT:v,status:m,lineType:"Solid"})}if(g!=""&&A==""){D.oData.lines.push({SOURCE:g,DESTINATION:g,CLIENT:v,status:m,lineType:"Solid"})}let i=this.getView().byId("ID_Green").getSelected();let l=this.getView().byId("ID_Grey").getSelected();let r=this.getView().byId("ID_Black").getSelected();let u=this.getView().byId("ID_Blue").getSelected();let c=false;if(p=="X"){for(var U=0;U<D.oData.final.length;U++){let e=D.oData.final[U];if(e.SOURCE.toUpperCase()==g&&e.INDSOURCE==R&&e.DESTINATION.toUpperCase()==A&&e.INDDEST==C&&e.NEW_FLAG.toUpperCase()=="O"){D.oData.lines.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"ReleventIndicator",lineType:"Dashed"});D.oData.lines.push({SOURCE:g,DESTINATION:A,status:"ReleventNode",lineType:"Solid"});c=true;break}}}if(c==false){if(e[h].RELATIONSHIP=="O"||e[h].RELATIONSHIP=="o"){if(R!=""&&C!=""){if(!a.includes(JSON.stringify([R,C]))){if(r==true){D.oData.lines.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"DemonReleInd",lineType:"Solid"});D.oData.linetmp.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"DemonReleInd",lineType:"Solid"})}}else{D.oData.lines.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"ReleventIndicator",lineType:"Solid"})}}if(g!=""&&A!=""){if(i==true){d=false;for(var L=0;L<D.oData.lines.length;L++){var w=D.oData.lines[L];var _=w.SOURCE;var x=w.DESTINATION;var H=w.lineType;var G=w.status;if(_==e[h].SOURCE&&x==e[h].DESTINATION){D.oData.lines[L].status="DemonReleNode";D.oData.linetmp[L].status="DemonReleNode";d=true;break}}if(d==false){D.oData.lines.push({SOURCE:g,DESTINATION:A,status:"DemonReleNode",lineType:"Solid"});D.oData.linetmp.push({SOURCE:g,DESTINATION:A,status:"DemonReleNode",lineType:"Solid"})}}else{d=false;for(var L=0;L<D.oData.lines.length;L++){var k=D.oData.lines[L];var X=k.SOURCE;var M=k.DESTINATION;var P=k.lineType;var F=k.status;if(X==e[h].SOURCE&&M==e[h].DESTINATION&&F=="DemonReleNode"){D.oData.lines[L].status="customLine";D.oData.linetmp[L].status="customLine";d=true;break}}if(d==false){D.oData.lines.push({SOURCE:g,DESTINATION:A,status:"customLine",lineType:"Solid"})}}}}else if(e[h].RELATIONSHIP=="x"||e[h].RELATIONSHIP=="X"){if(R!=""&&C!=""){if(!a.includes(JSON.stringify([R,C]))){if(u==true){D.oData.lines.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"NDemonReleInd",lineType:"Dashed"});D.oData.linetmp.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"NDemonReleInd",lineType:"Dashed"})}}else{D.oData.lines.push({SOURCE:g.concat(R),DESTINATION:A.concat(C),status:"customLineIndicator",lineType:"Solid"})}}if(g!=""&&A!=""){if(l==true){d=false;for(var B=0;B<D.oData.lines.length;B++){var V=D.oData.lines[B];var Y=V.SOURCE;var j=V.DESTINATION;var J=V.lineType;var W=V.status;if(Y==e[h].SOURCE&&j==e[h].DESTINATION){D.oData.lines[B].status="NDemonReleNode";D.oData.linetmp[B].status="NDemonReleNode";D.oData.lines[B].lineType="Dashed";D.oData.linetmp[B].lineType="Dashed";d=true;break}}if(d==false){D.oData.lines.push({SOURCE:g,DESTINATION:A,status:"NDemonReleNode",lineType:"Dashed"});D.oData.linetmp.push({SOURCE:g,DESTINATION:A,status:"NDemonReleNode",lineType:"Dashed"})}}else{d=false;for(var B=0;B<D.oData.lines.length;B++){var q=D.oData.lines[B];var $=q.SOURCE;var K=q.DESTINATION;var z=q.lineType;var Z=q.status;if($==e[h].SOURCE&&K==e[h].DESTINATION&&Z=="NDemonReleNode"){D.oData.lines[B].status="customLine";D.oData.linetmp[B].status="customLine";D.oData.lines[B].lineType="Solid";D.oData.linetmp[B].lineType="Solid";d=true;break}}if(d==false){D.oData.lines.push({SOURCE:g,DESTINATION:A,status:"customLine",lineType:"Solid"})}}}}else{d=false;for(let e=0;e<D.oData.linetmp.length;e++){if(D.oData.linetmp[e].SOURCE==g&&D.oData.linetmp[e].DESTINATION==A&&(D.oData.linetmp[e].status!="customLine"&&D.oData.linetmp[e].status!="ReleventNode")){D.oData.lines.push({SOURCE:g,DESTINATION:A,status:D.oData.linetmp[e].status,lineType:"Solid"});d=true;break}}if(p=="X"){if(d==false){if(!t.includes(JSON.stringify([g,A]))){D.oData.lines.push({SOURCE:g,DESTINATION:A,status:"customLine",lineType:"Solid"})}else{D.oData.lines.push({SOURCE:g,DESTINATION:A,CLIENT:v,status:m,lineType:"Solid"})}}}}}o.add(g);o.add(A);s.add(R);s.add(C)}for(var Q=0;Q<h;Q++){if(e[Q].SOURCE==g&&e[Q].DESTINATION==A&&e[Q].INDSOURCE==R&&e[Q].INDDEST==C){i.error("Duplicate is not allowed, index ".concat(Q+1));return}if(e[Q].SOURCE==g&&e[Q].DESTINATION==A&&C==""&&R==""){i.error("Duplicate is not allowed, index ".concat(Q+1));return}if(e[Q].SOURCE==g&&A==""&&C==""&&e[Q].INDSOURCE!=""&&e[Q].INDSOURCE==R){i.error("Duplicate indicators in 1 source is not allowed");return}if(e[Q].DESTINATION==A&&e[Q].INDDEST==C&&e[Q].INDDEST!=""&&g==""&&R==""){i.error("Duplicate indicators in 1 Destination is not allowed");return}}if(g==""||A==""){if(g!=""&&!o.has(g)){D.oData.groups.push({key:g,title:S,status:E,client:v});N[g]=new Set;D.oData.nodes.push({key:g,title:g,status:"Src_DesNode",shape:"Box",group:g,client:v});N[g].add(g)}if(A!=""&&!o.has(A)){D.oData.groups.push({key:A,title:I,status:f,client:v});N[A]=new Set;D.oData.nodes.push({key:A,title:A,status:"Src_DesNode",shape:"Box",group:A,client:v});N[A].add(A)}if(R!=""){if(g!=""&&!N[g].has(R)){D.oData.nodes.push({key:g.concat(R),title:R,status:"IndNode",shape:"Box",group:g,client:v});N[g].add(R)}if(g==""){i.error("Indicator with no Source node is not allowed");return}}if(C!=""){if(A!=""&&!N[A].has(C)){D.oData.nodes.push({key:A.concat(C),title:C,status:"IndNode",shape:"Box",group:A,client:v});N[A].add(C)}if(A==""){i.error("Indicator with no Desination node is not allowed");return}}o.add(g);o.add(A);s.add(R);s.add(C)}}for(let e=0;e<D.oData.lines.length;e++){if(D.oData.lines[e].status=="NDemonReleNode"){D.oData.lines[e].lineType="Dashed"}if(D.oData.lines[e].status=="customLine"){D.oData.lines[e].lineType="Solid"}}console.log("aaaaaaaaaaaaaaaaaaaaaa");D.refresh();console.log(D)},afterLayouting:function(e){let t=e.getSource();this._arrangeNodes(t);this._toTop(t);this._adjustLine(t)},search:function(e){var t=e.getParameter("key");R=t;var a=D.oData.input.length;var n;var i=[];if(t!=undefined){var o=t.indexOf("[");var s=t.indexOf("]");if(o!=-1&&s!=-1){O=[];C=t.substring(o+1,s);if(D.oData.input.length==1){D.oData.input=T}else{T=D.oData.input}for(var l=0;l<D.oData.input.length;l++){var r=D.oData.input[l].SOURCE;var u=D.oData.input[l].DESTINATION;var p=D.oData.input[l].SOURCE.concat(D.oData.input[l].INDSOURCE);var E=D.oData.input[l].DESTINATION.concat(D.oData.input[l].INDDEST);var S=D.oData.lines[C].SOURCE;var I=D.oData.lines[C].DESTINATION;var N=D.oData.lines[C].CLIENT;if(r==S&&u==I){n=D.oData.input[l];O.push(l);break}if(p==S&&E==I){n=D.oData.input[l];O.push(l);break}}D.oData.input=[];D.oData.input.push({SOURCE:n.SOURCE,INDSOURCE:n.INDSOURCE,DESTINATION:n.DESTINATION,INDDEST:n.INDDEST,RELATIONSHIP:n.RELATIONSHIP,AREA:n.AREA,DESAREA:n.DESAREA,CLIENT:f.CLIENT});D.refresh();c=1}else{O=[];T=D.oData.input;for(var l=0;l<D.oData.input.length;l++){if(D.oData.input[l].SOURCE==t||D.oData.input[l].DESTINATION==t||D.oData.input[l].SOURCE.concat(D.oData.input[l].INDSOURCE)==t||D.oData.input[l].DESTINATION.concat(D.oData.input[l].INDDEST)==t){i.push({SOURCE:D.oData.input[l].SOURCE,INDSOURCE:D.oData.input[l].INDSOURCE,DESTINATION:D.oData.input[l].DESTINATION,INDDEST:D.oData.input[l].INDDEST,RELATIONSHIP:D.oData.input[l].RELATIONSHIP,AREA:D.oData.input[l].AREA,DESAREA:D.oData.input[l].DESAREA,CLIENT:D.oData.input[l].CLIENT});O.push(l)}}D.oData.input=[];for(var d=0;d<i.length;d++){D.oData.input.push({SOURCE:i[d].SOURCE,INDSOURCE:i[d].INDSOURCE,DESTINATION:i[d].DESTINATION,INDDEST:i[d].INDDEST,RELATIONSHIP:i[d].RELATIONSHIP,AREA:i[d].AREA,DESAREA:i[d].DESAREA,CLIENT:i[d].CLIENT})}D.refresh();c=2}}else{if(T!=undefined){D.oData.input=T;T=undefined;R=undefined;c=3}D.refresh()}},refresh:function(){if(T!=undefined){D.oData.input=T;T=undefined}this._drawGraph(D.oData.input);D.refresh()},pressNode:function(e){var t=e.getParameter("id");O=[];var a=[];if(t!=""){var n=t.substring(74,t.length);if(T==undefined){T=D.oData.input}else{D.oData.input=T}for(var i=0;i<D.oData.input.length;i++){if(D.oData.input[i].SOURCE==D.oData.nodes[n].key||D.oData.input[i].SOURCE.concat(D.oData.input[i].INDSOURCE)==D.oData.nodes[n].key||D.oData.input[i].DESTINATION==D.oData.nodes[n].key||D.oData.input[i].DESTINATION.concat(D.oData.input[i].INDDEST)==D.oData.nodes[n].key){a.push({SOURCE:D.oData.input[i].SOURCE,INDSOURCE:D.oData.input[i].INDSOURCE,DESTINATION:D.oData.input[i].DESTINATION,INDDEST:D.oData.input[i].INDDEST,RELATIONSHIP:D.oData.input[i].RELATIONSHIP,AREA:D.oData.input[i].AREA,DESAREA:D.oData.input[i].DESAREA,CLIENT:D.oData.input[i].CLIENT});O.push(i)}}D.oData.input=[];for(var o=0;o<a.length;o++){D.oData.input.push({SOURCE:a[o].SOURCE,INDSOURCE:a[o].INDSOURCE,DESTINATION:a[o].DESTINATION,INDDEST:a[o].INDDEST,RELATIONSHIP:a[o].RELATIONSHIP,AREA:a[o].AREA,DESAREA:a[o].DESAREA,CLIENT:a[o].CLIENT})}D.refresh();h=1}},pressLine:function(e){var t;var a=e.getParameter("id");var n=a.substring(74,a.length);O=[];if(T==undefined){T=D.oData.input}else{D.oData.input=T}for(var i=0;i<D.oData.input.length;i++){var o=D.oData.input[i].SOURCE;var s=D.oData.input[i].DESTINATION;var l=D.oData.input[i].SOURCE.concat(D.oData.input[i].INDSOURCE);var r=D.oData.input[i].DESTINATION.concat(D.oData.input[i].INDDEST);var u=D.oData.lines[n].SOURCE;var p=D.oData.lines[n].DESTINATION;var E=D.oData.lines[n].CLIENT;if(o==u&&s==p){t=D.oData.input[i];O.push(i);break}if(l==u&&r==p){t=D.oData.input[i];O.push(i);break}}D.oData.input=[];D.oData.input.push({SOURCE:t.SOURCE,INDSOURCE:t.INDSOURCE,DESTINATION:t.DESTINATION,INDDEST:t.INDDEST,RELATIONSHIP:t.RELATIONSHIP,AREA:t.AREA,DESAREA:t.DESAREA,CLIENT:b});D.refresh();h=2},selectChange:function(e){var t=e.getParameters()},_switchNodes:function(e,t,a){let n=e.getY();e.setY(t.getY());t.setY(n)},_arrangeNodes:function(e){let t=e.getGroups();let a=this.getView().getModel("settings").oData.nodeSpacing;for(let e=0;e<t.length;e++){let i=t[e].mProperties.status;if(i==="Group2"){let i=t[e].getNodes();let o=t[e].getKey();let s,l,r;let u=0;let D=Infinity;for(var n=0;n<i.length;n++){let e=i[n];let t=e.getKey();if(u<e._iWidth){u=e._iWidth}if(D>e.getX()){D=e.getX()}if(t==o){s=e;s.addStyleClass("BoldText")}else{e.removeStyleClass("BoldText")}}s.setX(D);let p=s.getX();for(let e=0;e<i.length;e++){let t=i[e];if(t!=s){t.setX(p)}}t[e].setX(s.getX()-a);t[e]._iWidth=u+a+10}}},_toTop:function(e){let t=e.getGroups();for(var a=0;a<t.length;a++){let e=t[a];let E=e.mProperties.status;if(E==="Group2"){var n=e.getNodes();var i=e.getKey();var o,s;var l=Infinity;for(var r=0;r<n.length;r++){var u=n[r];var D=u.getY();var p=u.getKey();if(D<l){o=u;l=D}if(p==i){s=u}}if(o!=s){this._switchNodes(o,s,n)}}}},_adjustLine:function(e){let t=this._getGroupArea(e);this._narrowIndGap(e);this._adjustLineCoordinatorsAdvance(e,t)},_adjustLineCoordinatorsAdvance:function(e,t){let a=e.getGroups();a.forEach(e=>{let a=e.mProperties.status;if(a==="Group2"){let a=e.getNodes();let n=a.length;for(let i=0;i<n;i++){let n=a[i];let o=e._iWidth;let s=e._iHeight;let l=e.getX();let r=e.getY();let u=this.getView().getModel("settings").oData.nodeSpacing;let D=n.getChildLines();let p=n.getParentLines();let E=D.length;let f=p.length;let S=n.getX();let I=n.getY();let c=n._iWidth;let T=n._iHeight;let N=D;let d=p;N.sort((e,t)=>{let a=e.getCoordinates()[0];let n=t.getCoordinates()[0];return a.getY()-n.getY()});for(let e=0;e<E;e++){let a=N[e];let n=T/E;let i=a.getCoordinates();let s=i[0];let r=i[i.length-1];let D=a.getBends();let p=D[0];s.setX(S+c);s.setY(I+(e+.5)*n);if(p){let n=new sap.suite.ui.commons.networkgraph.Coordinate({x:l+o+5,y:s.getY()});let i=this._isLineCross(t,n,p).xLeft;if(i==l){p.setX(l+o+(e+.5)*5);p.setY(s.getY());D[1].setX(l+o+(e+.5)*5)}else if(i!=false){let t=new sap.suite.ui.commons.networkgraph.Coordinate({x:l+o+(e+.5)*5,y:s.getY()});let n=new sap.suite.ui.commons.networkgraph.Coordinate({x:l+o+(e+.5)*5,y:p.getY()});a.insertCoordinate(t,1);a.insertCoordinate(n,2)}else{p.setY(s.getY())}}else{a.addBend({x:s.getX()+u,y:s.getY()});a.addBend({x:s.getX()+u,y:r.getY()})}D=a.getBends();for(let e=0;e<D.length-1;e++){if(D[e].getX()==D[e+1].getX()){let a=this._isLineCross(t,D[e],D[e+1]);if(a){D[e].setX(a.xRight+u);D[e+1].setX(D[e].getX())}}}}d.sort((e,t)=>{let a=e.getCoordinates();let n=t.getCoordinates();return a[a.length-1].getY()-n[n.length-1].getY()});for(let e=0;e<f;e++){let a=d[e];let n=a.getBends();let i=T/f;let o=a.getCoordinates();let s=o[0];let r=o[o.length-1];let u=r.getY();let D=n[n.length-1];r.setX(S);r.setY(I+(e+.5)*i);if(D){let i=new sap.suite.ui.commons.networkgraph.Coordinate({x:l-5,y:r.getY()});let o=this._isLineCross(t,i,D).xLeft;if(o==l){D.setX(l-(e+.5)*5);D.setY(r.getY());n[n.length-2].setX(D.getX())}else if(o!=false){a.addBend({x:l-(e+.5)*5,y:D.getY()});a.addBend({x:l-(e+.5)*5,y:r.getY()})}else{D.setY(r.getY())}}else{a.addBend({x:l-(e+.5)*5,y:s.getY()});a.addBend({x:l-(e+.5)*5,y:r.getY()})}this._removeUselessBends(a,t)}}}})},_removeUselessBends:function(e,t){let a=0;let n=e.getBends();while(n.length>3&&a<=n.length-3){let i=n[a];let o=n[a+1];let s=n[a+2];let l;if(i.getX()==o.getX()){l=new sap.suite.ui.commons.networkgraph.Coordinate({x:s.getX(),y:i.getY()})}else{l=new sap.suite.ui.commons.networkgraph.Coordinate({x:i.getX(),y:s.getY()})}let r=this._isLineCross(t,i,l);let u=this._isLineCross(t,s,l);if(r||u){a=a+1}else{e.removeCoordinate(a+1);e.removeCoordinate(a+1);e.removeCoordinate(a+1);e.insertCoordinate(l,a+1);n=e.getBends()}}},_getGroupArea:function(e){let t=e.getGroups();let a=[];t.forEach(e=>{let t={};let n=e.getX();let i=e.getY();t.xLeft=e.getX();t.yLeft=e.getY();t.xRight=n+e._iWidth;t.yRight=i+e._iHeight;a.push(t)});return a},_isLineCross:function(e,t,a){let n=e.length;let i=t.getX();let o=a.getX();let s=t.getY();let l=a.getY();let r=s<l?s:l;let u=s>l?s:l;let D=i<o?i:o;let p=i>o?i:o;for(let t=0;t<n;t++){let a=e[t];if(a.xLeft>p||D>a.xRight){continue}if(a.yLeft>u||r>a.yRight){continue}return a}return false},_narrowIndGap:function(e){let t=e.getGroups();t.forEach(e=>{let t=e.getNodes();let a=e.mProperties.status;if(a==="Group2"){let a=t;if(a.length>1){let t=a[0]._iHeight;a.sort((e,t)=>e.getY()-t.getY());a[1].setY(a[0].getY()+t+20);for(let e=2;e<a.length;e++){a[e].setY(a[e-1].getY()+t+5)}e._iHeight=a[a.length-1].getY()+t+30-e.getY()}}})},_confirmDialog:function(e){this.oApproveDialog=new Dialog({type:sap.m.DialogType.Message,title:"Confirm",content:new sap.m.Text({text:e}),draggable:true,beginButton:new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:"Confirm",press:function(){this.oApproveDialog.close()}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this.oApproveDialog.close()}.bind(this)})});this.oApproveDialog.open()},_confirmDialogWithDetail:function(e){console.log(this.getView().getModel());this.oApproveDialogWithDetail=new Dialog({type:sap.m.DialogType.Message,title:e,draggable:true,resizable:true,content:new sap.ui.table.Table({selectionMode:"None",rows:"{/input}",columns:[new sap.ui.table.Column({label:"SOURCE",template:new sap.m.Text({text:"{SOURCE}"})}),new sap.ui.table.Column({label:" Indicator of SOURCE",template:new sap.m.Text({text:"{INDSOURCE}"})}),new sap.ui.table.Column({label:"DESTINATION",template:new sap.m.Text({text:"{DESTINATION}"})}),new sap.ui.table.Column({label:"Indicator of DESTINATION",template:new sap.m.Text({text:"{INDDEST}"})}),new sap.ui.table.Column({label:"RELATIONSHIP",template:new sap.m.Text({text:"{RELATIONSHIP}"})})]}),beginButton:new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:"Confirm",press:function(){this.oApproveDialogWithDetail.close()}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){this.oApproveDialogWithDetail.close()}.bind(this)})});this.getView().addDependent(this.oApproveDialogWithDetail);this.oApproveDialogWithDetail.open()},inputToChange:function(e){},deleteRow:function(e){var t=e.getSource().getBindingContext().getObject();g=1;if(R!=undefined){for(var a=0;a<D.oData.input.length;a++){if(D.oData.input[a]==t){D.oData.input.splice(a,1);D.oData.lines.splice(a,1)}}for(var n=0;n<T.length;n++){if(T[n].SOURCE==t.SOURCE&&T[n].INDSOURCE==t.INDSOURCE&&T[n].DESTINATION==t.DESTINATION&&T[n].INDDEST==t.INDDEST&&T[n].AREA==t.AREA&&T[n].DESAREA==t.DESAREA){T.splice(n,1)}}if(p=="X"){for(var i=0;i<D.oData.final.length;i++){if(D.oData.final[i].SOURCE==t.SOURCE&&D.oData.final[i].INDSOURCE==t.INDSOURCE&&D.oData.final[i].DESTINATION==t.DESTINATION&&D.oData.final[i].INDDEST==t.INDDEST&&D.oData.final[i].MATCH_FLAG==t.RELATIONSHIP&&D.oData.final[i].CLIENT==t.CLIENT){D.oData.final.splice(i,1)}}}this.inputFromChange();return}for(var a=0;a<D.oData.input.length;a++){if(D.oData.input[a]==t){console.log(D.oData.input[a]);D.oData.input.splice(a,1);D.oData.lines.splice(a,1)}}if(p=="X"){for(var i=0;i<D.oData.final.length;i++){if(D.oData.final[i].SOURCE==t.SOURCE&&D.oData.final[i].INDSOURCE==t.INDSOURCE&&D.oData.final[i].DESTINATION==t.DESTINATION&&D.oData.final[i].INDDEST==t.INDDEST&&D.oData.final[i].CLIENT==t.CLIENT){D.oData.final.splice(i,1)}}}for(var n=0;n<f.length;n++){if(f[n].SOURCE==t.SOURCE&&f[n].INDSOURCE==t.INDSOURCE&&f[n].DESTINATION==t.DESTINATION&&f[n].INDDEST==t.INDDEST&&f[n].AREA==t.AREA&&f[n].DESAREA==t.DESAREA&&f[n].CLIENT==t.CLIENT){f.splice(n,1)}this.inputFromChange()}},thanos:function(e){m="Standard";var t;for(var a=0;a<f.length;a++){t=a;if(f[a].CLIENT==b){f.splice(a,1);a=t-1}}for(var n=0;n<D.oData.input.length;n++){t=n;if(D.oData.input[n].CLIENT==b){D.oData.input.splice(n,1);n=t-1}}this.inputFromChange()},merge:function(){let e=[JSON.stringify(["キャリア採用数","女性管理職比率"]),JSON.stringify(["女性管理職比率","社員の定着率"]),JSON.stringify(["社員の定着率","特許出願件数"]),JSON.stringify(["特許出願件数","ROE"]),JSON.stringify(["Industrial waste recycling rate","Number of press releases"]),JSON.stringify(["Number of press releases","Number of customers in open factory"]),JSON.stringify(["Number of customers in open factory","Sales amount"]),JSON.stringify(["Sales amount","PBR"]),JSON.stringify(["Sales amount","ROE"])];E=true;errMes=0;D.oData.linetmp=[];if(p!="X"){D.oData.final=[];let e=this.getView().byId("ID_Green").getSelected();let n=this.getView().byId("ID_Grey").getSelected();let o=this.getView().byId("ID_Black").getSelected();let s=this.getView().byId("ID_Blue").getSelected();var t=this;var a=`/graph/getSignificant(clientkey='${b}')`;let l;$.ajax({url:a,type:"GET",method:"GET",success:function(e,t,a){l=e.value;if(l.length<1){i.show("Client does not have Significant data to do Analysing",{title:"Analysing Failed"});errMes=1;return}let n=D.oData.input;let o=n.length;let s=l.length;for(let e=0;e<o;e++){D.oData.final.push({CLIENT:b,CLIENT_ITEM:w,SOURCE:n[e].SOURCE,INDSOURCE:n[e].INDSOURCE,DESTINATION:n[e].DESTINATION,INDDEST:n[e].INDDEST,MATCH_FLAG:"",NEW_FLAG:"",AREA:n[e].AREA,DESAREA:n[e].DESAREA})}for(let e=0;e<o;e++){let t=n[e];let a=t.SOURCE.toUpperCase();let i=t.INDSOURCE;let o=t.DESTINATION.toUpperCase();let f=t.INDDEST;let S=t.RELATIONSHIP;let I=t.CLIENT.toUpperCase();let c=t.AREA;let T=t.DESAREA;for(let t=0;t<s;t++){if(i==l[t].INDSOURCE&&f==l[t].INDDEST&&I==l[t].CLIENT.toUpperCase()&&i!=""&&f!=""){for(var r=0;r<D.oData.lines.length;r++){if(D.oData.lines[r].SOURCE.toUpperCase()==a.concat(i).toUpperCase()&&D.oData.lines[r].DESTINATION.toUpperCase()==o.concat(f).toUpperCase()){D.oData.lines.splice(r,1);break}}for(var u=0;u<D.oData.lines.length;u++){if(D.oData.lines[u].SOURCE.toUpperCase()==a.toUpperCase()&&D.oData.lines[u].DESTINATION.toUpperCase()==o.toUpperCase()){D.oData.lines.splice(u,1);break}}for(var E=0;E<D.oData.final.length;E++){if(D.oData.final[E].INDSOURCE.toUpperCase()==l[t].INDSOURCE.toUpperCase()&&D.oData.final[E].INDDEST.toUpperCase()==l[t].INDDEST.toUpperCase()&&D.oData.final[E].CLIENT.toUpperCase()==l[t].CLIENT.toUpperCase()){D.oData.final[E].MATCH_FLAG=l[t].CORR_MATCH_FLG;D.oData.input[e].RELATIONSHIP=l[t].CORR_MATCH_FLG}}p="X";this._drawGraph(D.oData.input);p=""}}}D.refresh();console.log(D);D.refresh()}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});if(errMes==1){return}}console.log(D.oData.final);var n=`/graph/deletefinal(clientkey='${b}')`;$.ajax({url:n,type:"GET",method:"GET",success:function(e,t,a){console.log("success delete final")}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});$.ajax({url:"/graph/FINAL_VIEW",type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Content-Type","application/atom+xml");e.setRequestHeader("DataServiceVersion","2.0");e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){var n=a.getResponseHeader("X-CSRF-Token");let i;if(n!=null||n!=undefined){i={"X-CSRF-Token":n,"Content-Type":"application/json"}}else{i={"Content-Type":"application/json"}}let o=Object.assign([],D.oData.final);$.ajax({type:"POST",url:"/graph/upload_final",data:JSON.stringify({finalData:o}),headers:i,cache:false,success:function(e){console.log("Success upload final",e)},error:function(e){console.log("error",e)}})}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)})},upload:function(){let e=0;var t=D.oData.nodes;var a=D.oData.lines;var n=D.oData.input;var o={};var s={};var n={};if(n.length==0){return}let l=this.getView();l.setBusy(true);let r=this;if(_!=0){var u=`/graph/deleteInput(clientkey='${b}')`;$.ajax({url:u,type:"GET",method:"GET",success:function(e,t,a){console.log("success delete Input view")}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)})}var p;var E=0;for(var S=0;S<f.length;S++){p=S;if(f[S].CLIENT==b){f.splice(S,1);S=p-1}}for(var I=0;I<D.oData.input.length;I++){D.oData.input[I].RELATIONSHIP="";if(D.oData.input[I].AREA==undefined){D.oData.input[I].AREA=""}if(D.oData.input[I].DESAREA==undefined){D.oData.input[I].DESAREA=""}}let c=D.oData.input;c=[];for(var T=0;T<D.oData.input.length;T++){c.push({SOURCE:D.oData.input[T].SOURCE,INDSOURCE:D.oData.input[T].INDSOURCE,DESTINATION:D.oData.input[T].DESTINATION,INDDEST:D.oData.input[T].INDDEST,RELATIONSHIP:D.oData.input[T].RELATIONSHIP,AREA:D.oData.input[T].AREA,DESAREA:D.oData.input[T].DESAREA,CLIENT:b})}D.oData.input=[];D.oData.input=c;$.ajax({url:"/graph/INPUT_VIEW",type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Content-Type","application/atom+xml");e.setRequestHeader("DataServiceVersion","2.0");e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){var n=a.getResponseHeader("X-CSRF-Token");let o;if(n!=null||n!=undefined){o={"X-CSRF-Token":n,"Content-Type":"application/json"}}else{o={"Content-Type":"application/json"}}let s=Object.assign([],D.oData.input);for(let e=0;e<s.length;e++){s[e].CLIENT=b;if(s[e].RELATIONSHIP==undefined){s[e].RELATIONSHIP=""}if(s[e].AREA==undefined){s[e].AREA=""}if(s[e].DESAREA==undefined){s[e].DESAREA=""}}console.log(b,s);$.ajax({type:"POST",url:"/graph/upload",data:JSON.stringify({uploadData:s}),headers:o,cache:false,success:function(e){console.log("success",e);l.setBusy(false);i.show("Success",{title:"Upload Completed"});r.fetchClients()},error:function(e){console.log("error",e);l.setBusy(false);i.show("Server is busy now, please try again",{title:"Upload Failed"})}})}.bind(this),error:function(e){l.setBusy(false);console.log(e);errMes=1}.bind(this)})},fetchDataAfterUpload:function(){f=[];var e="/graph/INPUT_VIEW";$.ajax({url:e,type:"GET",method:"GET",success:function(e,t,a){f=e.value;D.refresh()}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)})},uniqBy:function(e,t){var a={};return e.filter(function(e){var n=t(e);return a.hasOwnProperty(n)?false:a[n]=true})},uploadWithWait:function(e){if(T!=undefined){D.oData.input=T;T=undefined}_=0;var t=this;b=this.byId("clientInput").getValue();if(b==""){i.error("Please choose existing client or create new");return}if(b!=""){if(D.oData.client.length!=0){for(var a=0;a<D.oData.client.length;a++){if(D.oData.client[a].CLIENTKEY==b){_=1;break}}}if(_==0){i.warning("Client does not exist! \n Do you want to create new client and save data?",{icon:i.Icon.WARNING,title:"No Client found",actions:[i.Action.OK,i.Action.CANCEL],onClose:function(e){t.fnCallbackConfirm(e)},emphasizedAction:i.Action.OK,initialFocus:i.Action.CANCEL,styleClass:x});return}else{i.warning("Do you want to upload to current client ? ".concat(b),{icon:i.Icon.WARNING,title:"Warning",actions:[i.Action.OK,i.Action.CANCEL],onClose:function(e){t.fnCallbackConfirm(e)},emphasizedAction:i.Action.OK,initialFocus:i.Action.CANCEL,styleClass:x})}}if(b==""&&D.oData.input.length==0&&D.oData.nodes.length==0&&D.oData.lines.length==0&&D.oData.groups.length==0){var n="/graph/hdbprocedure()";$.ajax({url:n,type:"GET",method:"GET",success:function(e,t,a){}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});setTimeout(this.upload.bind(this),9e3)}D.refresh()},uploadWithClient:function(e){if(e=="OK"){if(p=="X"){var t=`/graph/deletefinal(clientkey='${b}')`;$.ajax({url:t,type:"GET",method:"GET",success:function(e,t,a){console.log("success delete final")}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});console.log(D.oData.final);$.ajax({url:"/graph/FINAL_VIEW",type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Content-Type","application/atom+xml");e.setRequestHeader("DataServiceVersion","2.0");e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){var n=a.getResponseHeader("X-CSRF-Token");let i;if(n!=null||n!=undefined){i={"X-CSRF-Token":n,"Content-Type":"application/json"}}else{i={"Content-Type":"application/json"}}let o=Object.assign([],D.oData.final);$.ajax({type:"POST",url:"/graph/upload_final",data:JSON.stringify({finalData:o}),headers:i,cache:false,success:function(e){console.log("success upload final",e)},error:function(e){console.log("error",e)}})}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});p=""}var t=`/graph/deletesingle(clientkey='${b}')`;$.ajax({url:t,type:"GET",method:"GET",success:function(e,t,a){console.log(e)}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});setTimeout(this.upload.bind(this),1e4)}},getCSRFToken:function(){this.on("getCSRFToken",()=>"Token")},fnCallbackConfirm:function(e){var t="Client ";var a={};if(e=="OK"){this.getView().setBusy(true);w="TESTING";if(_==0){N.push({CLIENTKEY:b,CLIENT_ITEM:w,TITLE:t.concat(b)});D.oData.client.push({CLIENTKEY:b,CLIENT_ITEM:w,TITLE:t.concat(b)});D.refresh();a.CLIENTKEY=b;a.CLIENT_ITEM=w;a.TITLE=t.concat(b);a.MATRIX="";a.CHART="O";var n="/graph/CLIENT_VIEW";var i;var o=new XMLHttpRequest;$.ajax({url:n,type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Content-Type","application/atom+xml");e.setRequestHeader("DataServiceVersion","2.0");e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,o){i=o.getResponseHeader("X-CSRF-Token");let s;if(i!=null||i!=undefined){s={"X-CSRF-Token":i,"Content-Type":"application/json"}}else{s={"Content-Type":"application/json"}}console.log(i);$.ajax({url:n,data:JSON.stringify(a),type:"POST",headers:s,success:function(e,t,a){console.log("Client created")}.bind(this),error:function(e){console.log(e);console.log(JSON.stringify(a));errMes=1}.bind(this)})}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)})}if(p=="X"){var s=`/graph/deletefinal(clientkey='${b}')`;$.ajax({url:s,type:"GET",method:"GET",success:function(e,t,a){console.log("success delete final")}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});var l=new XMLHttpRequest;$.ajax({url:"/graph/FINAL_VIEW",type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Content-Type","application/atom+xml");e.setRequestHeader("DataServiceVersion","2.0");e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){var n=a.getResponseHeader("X-CSRF-Token");let i;if(n!=null||n!=undefined){i={"X-CSRF-Token":n,"Content-Type":"application/json"}}else{i={"Content-Type":"application/json"}}for(let e=0;e<D.oData.final.length;e++){D.oData.final[e].CLIENT=b;D.oData.final[e].CLIENT_ITEM=w}console.log(b,D.oData.final);let o=Object.assign([],D.oData.final);$.ajax({type:"POST",url:"/graph/upload_final",data:JSON.stringify({finalData:o}),headers:i,cache:false,success:function(e){console.log("success upload final",e)},error:function(e){console.log("error",e)}})}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});p=""}setTimeout(this.upload.bind(this),9e3)}},onChange:async function(e){p="";let t=e.getSource();let a=e.getParameters().files;if(a.length==0){alert("Please choose any file...");return}var n=a[0].name;var i=n.substring(n.lastIndexOf(".")).toUpperCase();if(i==".XLS"||i==".XLSX"){this._excelFileToJSON(a[0])}else if(i==".CSV"){this.handleFiles(e)}else{alert("Please select a valid XLSX file.")}},onChange_:async function(e){p="X";let t=e.getSource();let a=e.getParameters().files;if(a.length==0){alert("Please choose any file...");return}var n=a[0].name;var i=n.substring(n.lastIndexOf(".")).toUpperCase();if(i==".XLS"||i==".XLSX"){this._excelFileToJSON(a[0])}else if(i==".CSV"){this.handleFiles_final(e)}else{alert("Please select a valid XLSX file.")}},_excelFileToJSON:function(e){try{var t=new FileReader;t.readAsBinaryString(e);t.onload=function(e){var t=e.target.result;var a=XLSX.read(t,{type:"binary"});var n={};var i={};var o=[];a.SheetNames.forEach(function(e){o.push(e);var t=XLSX.utils.sheet_to_row_object_array(a.Sheets[e]);if(t.length>0){n[e]=t;i[e]=Object.keys(t[0])}});return n}.bind(this)}catch(e){console.error(e)}},handleFiles:function(e){b=this.byId("clientInput").getValue();var t=e.getParameters().files["0"];var a=new FileReader;a.readAsText(t);a.onload=i;a.onerror=s;var n=this;function i(e){console.log(e);var t=e.target.result;o(t)}function o(e){var t=e.split(/\r\n|\n/);D.oData.input=[];for(var a=1;a<t.length-1;a++){var i=t[a].split(",");if(i[0]=="1"){i[0]="ESG Activity"}if(i[0]=="2"){i[0]="Cost for ESG KPI"}if(i[0]=="3"){i[0]="Effects/Impacts"}if(i[3]=="1"){i[3]="ESG Activity"}if(i[3]=="2"){i[3]="Cost for ESG KPI"}if(i[3]=="3"){i[3]="Effects/Impacts"}D.oData.input.push({SOURCE:i[1],INDSOURCE:i[2],DESTINATION:i[4],INDDEST:i[5],RELATIONSHIP:i[6],AREA:i[0],DESAREA:i[3],CLIENT:b});p=""}D.refresh();E=false;n._drawGraph(D.oData.input);D.refresh()}function s(e){if(e.target.error.name=="NotReadableError"){alert("Cannot read file !")}}},handleFiles_final:function(e){b=this.byId("clientInput").getValue();var t=e.getParameters().files["0"];var a=new FileReader;a.readAsText(t);a.onload=i;a.onerror=s;var n=this;function i(e){console.log(e);var t=e.target.result;o(t)}function o(e){var t=e.split(/\r\n|\n/);D.oData.input=[];for(var a=1;a<t.length-1;a++){var i=t[a].split(",");D.oData.input.push({SOURCE:i[1],INDSOURCE:i[2],DESTINATION:i[4],INDDEST:i[5],RELATIONSHIP:i[6],AREA:i[0],DESAREA:i[3],CLIENT:b});D.oData.final.push({SOURCE:i[1],INDSOURCE:i[2],DESTINATION:i[4],INDDEST:i[5],MATCH_FLAG:i[6],NEW_FLAG:i[7],AREA:i[0],DESAREA:i[3],CLIENT:b});p="X"}D.refresh();E=false;n._drawGraph(D.oData.input);D.refresh()}function s(e){if(e.target.error.name=="NotReadableError"){alert("Cannot read file !")}}},handleUploadComplete:function(e){var t=this.byId("fileUploader");t.clear()},delClient:function(){if(b==""){i.warning("Please choose client first");return}var e=this;i.warning("Do you want to delete client ".concat(b).concat(" and its data?"),{icon:i.Icon.WARNING,title:"Warning",actions:[i.Action.OK,i.Action.CANCEL],onClose:function(t){e.delClientData(t);if(t=="OK"){D.oData.input=[];D.oData.nodes=[];D.oData.lines=[];D.oData.groups=[];N=[];for(var a=0;a<N.length;a++){if(N[a].CLIENTKEY==b){N.splice(a,1)}}for(var a=0;a<D.oData.client.length;a++){if(D.oData.client[a].CLIENTKEY==b){D.oData.client.splice(a,1)}}D.refresh();e.fetchClients();E=false;e._drawGraph(D.oData.input);i.show("Success",{title:"Delete Completed"});e.getView().setBusy(false);D.refresh()}},emphasizedAction:i.Action.OK,initialFocus:i.Action.CANCEL,styleClass:x})},delClientData:function(e){var t="Client ";var a={};let n=this;if(e=="OK"){this.getView().setBusy(true);let e=true;var o={};for(let t=0;t<D.oData.client.length;t++){let a=D.oData.client[t];if(a.MATRIX=="O"&&a.CLIENTKEY==b){e=false;o.CLIENTKEY=D.oData.client[t].CLIENTKEY;o.CLIENT_ITEM="TESTING";o.TITLE=D.oData.client[t].TITLE;o.MATRIX=D.oData.client[t].MATRIX;o.CHART="";break}}var s=`/graph/deleteclient(clientkey='${b}')`;$.ajax({url:s,type:"GET",method:"GET",success:function(t,a,n){if(e==false){var i="/graph/CLIENT_VIEW";var s;var l=new XMLHttpRequest;$.ajax({url:i,type:"GET",beforeSend:function(e){e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.setRequestHeader("Content-Type","application/atom+xml");e.setRequestHeader("DataServiceVersion","2.0");e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){s=a.getResponseHeader("X-CSRF-Token");let n;if(s!=null||s!=undefined){n={"X-CSRF-Token":s,"Content-Type":"application/json"}}else{n={"Content-Type":"application/json"}}console.log(s);$.ajax({url:i,data:JSON.stringify(o),type:"POST",headers:n,success:function(e,t,a){console.log("Client updated");D.refresh()}.bind(this),error:function(e){console.log(e);console.log(JSON.stringify(o));errMes=1}.bind(this)})}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)})}}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)});s=`/graph/deletesingle(clientkey='${b}')`;$.ajax({url:s,type:"GET",method:"GET",success:function(e,t,a){D.refresh();this.getView().setBusy(false)}.bind(this),error:function(e){console.log(e);i.success("Deletion got errors: ".concat(e));errMes=1}.bind(this)})}},downloadHypothesis:function(e){if(D.oData.input.length==0){i.error("No data to download");return}let t="Hypothesis_List_"+b+".xlsx";let a=D.oData.input;let n=[];n.push({label:"AREA",property:"AREA",width:"5"});n.push({label:"SOURCE",property:"SOURCE",width:"5"});n.push({label:"INDSOURCE",property:"INDSOURCE",width:"5"});n.push({label:"DESAREA",property:"DESAREA",width:"5"});n.push({label:"DESTINATION",property:"DESTINATION",width:"5"});n.push({label:"INDDEST",property:"INDDEST",width:"5"});let l={workbook:{columns:n},dataSource:a,fileName:t};let r=new s(l);r.build().then(function(){o.show("Spreadsheet export has finished")}).finally(function(){r.destroy()})},downloadFinal:function(e){if(D.oData.final.length==0){i.error("No data to download");return}let t="Final_List"+b+".xlsx";let a=D.oData.final;let n=[];n.push({label:"AREA",property:"AREA",width:"5"});n.push({label:"SOURCE",property:"SOURCE",width:"5"});n.push({label:"INDSOURCE",property:"INDSOURCE",width:"5"});n.push({label:"DESAREA",property:"DESAREA",width:"5"});n.push({label:"DESTINATION",property:"DESTINATION",width:"5"});n.push({label:"INDDEST",property:"INDDEST",width:"5"});n.push({label:"MATCH_FLAG",property:"MATCH_FLAG",width:"5"});n.push({label:"NEW_FLAG",property:"NEW_FLAG",width:"5"});let l={workbook:{columns:n},dataSource:a,fileName:t};let r=new s(l);r.build().then(function(){o.show("Spreadsheet export has finished")}).finally(function(){r.destroy()})},itemCloseHandler:function(e){e.preventDefault()},itemSelect:function(e){let t=this.getView().byId("TabContainer").getSelectedItem();let a;var n;if(t!=null){if(t.includes("tabitem2")){if(E==true||p=="X"){let e=this.getView().byId("ID_Green").getSelected();let t=this.getView().byId("ID_Grey").getSelected();let p=this.getView().byId("ID_Black").getSelected();let E=this.getView().byId("ID_Blue").getSelected();if(e==false){for(var i=0;i<D.oData.lines.length;i++){var o=D.oData.lines[i];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(u=="DemonReleNode"){D.oData.lines[i].status="customLine";console.log(s+" , "+l);D.refresh()}}}else{for(var i=0;i<D.oData.linetmp.length;i++){var f=D.oData.linetmp[i];var S=f.SOURCE;var I=f.DESTINATION;var c=f.lineType;var T=f.status;if(T=="DemonReleNode"){for(var N=0;N<D.oData.lines.length;N++){var o=D.oData.lines[N];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(s==S&&l==I){D.oData.lines[N].status=T;D.refresh();console.log("ENABLE GREEN CONNECTOR")}}}}}if(t==false){for(var d=0;d<D.oData.lines.length;d++){var o=D.oData.lines[d];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(u=="NDemonReleNode"){D.oData.lines[d].status="customLine";D.oData.lines[d].lineType="Solid";console.log(s+" , "+l);D.refresh()}}}else{for(var d=0;d<D.oData.linetmp.length;d++){var f=D.oData.linetmp[d];var S=f.SOURCE;var I=f.DESTINATION;var c=f.lineType;var T=f.status;if(T=="NDemonReleNode"){for(var N=0;N<D.oData.lines.length;N++){var o=D.oData.lines[N];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(s==S&&l==I){D.oData.lines[N].status=T;D.oData.lines[N].lineType="Dashed";D.refresh();console.log("ENABLE GREY CONNECTOR")}}}}}a=false;if(p==false){n=0;for(var h=0;h<D.oData.lines.length;h++){var o=D.oData.lines[h];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(u=="DemonReleInd"){n=h;D.oData.lines.splice(h,1);console.log(s+" , "+l);D.refresh();h=n-1}}}else{for(var h=0;h<D.oData.linetmp.length;h++){var f=D.oData.linetmp[h];var S=f.SOURCE;var I=f.DESTINATION;var c=f.lineType;var T=f.status;if(T=="DemonReleInd"){for(var N=0;N<D.oData.lines.length;N++){var o=D.oData.lines[N];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(s==S&&l==I){a=true;break}}if(a!=true){D.oData.lines.push({SOURCE:S,DESTINATION:I,status:T,lineType:c});D.refresh();console.log("ENABLE BLACK CONNECTOR");a=false}}}}a=false;if(E==false){n=0;for(var g=0;g<D.oData.lines.length;g++){var o=D.oData.lines[g];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(u=="NDemonReleInd"){n=g;D.oData.lines.splice(g,1);console.log(s+" , "+l);D.refresh();g=n-1}}}else{for(var g=0;g<D.oData.linetmp.length;g++){var f=D.oData.linetmp[g];var S=f.SOURCE;var I=f.DESTINATION;var c=f.lineType;var T=f.status;if(T=="NDemonReleInd"){for(var N=0;N<D.oData.lines.length;N++){var o=D.oData.lines[N];var s=o.SOURCE;var l=o.DESTINATION;var r=o.lineType;var u=o.status;if(s==S&&l==I){a=true;break}}if(a!=true){D.oData.lines.push({SOURCE:S,DESTINATION:I,status:T,lineType:c});D.refresh();console.log("ENABLE BLUE CONNECTOR");a=false}}}}}else{}}}D.refresh()},getFinal:function(){var e=`/graph/getFinal(clientkey='${b}')`;let t;$.ajax({url:e,type:"GET",method:"GET",success:function(e,a,n){t=e.value;console.log(e);D.refresh()}.bind(this),error:function(e){console.log(e);errMes=1}.bind(this)})},displayFinal:function(e){if(b==""){i.error("Please choose a client.");return}var t=`/graph/getFinal(clientkey='${b}')`;let a;$.ajax({url:t,type:"GET",method:"GET",success:function(e,t,n){a=e.value;let o=D.oData.input;let s="";let l=D.oData.input.length;D.oData.final=[];D.oData.input=[];for(var r=0;r<a.length;r++){if(a[r].CLIENT==b){s=="";D.oData.final.push({SOURCE:a[r].SOURCE,INDSOURCE:a[r].INDSOURCE,DESTINATION:a[r].DESTINATION,INDDEST:a[r].INDDEST,CLIENT:a[r].CLIENT,CLIENT_ITEM:a[r].CLIENT_ITEM,MATCH_FLAG:a[r].MATCH_FLAG,NEW_FLAG:a[r].NEW_FLAG,AREA:a[r].AREA,DESAREA:a[r].DESAREA});D.oData.input.push({SOURCE:a[r].SOURCE,INDSOURCE:a[r].INDSOURCE,DESTINATION:a[r].DESTINATION,INDDEST:a[r].INDDEST,CLIENT:a[r].CLIENT,RELATIONSHIP:a[r].MATCH_FLAG,AREA:a[r].AREA,DESAREA:a[r].DESAREA,editable:true})}}if(D.oData.final.length!=0){D.refresh();p="X";this._drawGraph(D.oData.input);E=false}else{if(b!=""){i.error("Client has no Final data.")}D.oData.input=[];D.refresh();p="";E=false;this._drawGraph(D.oData.input)}console.log(e);D.refresh()}.bind(this),error:function(e){console.log(e);errMes=1;p="";i.error("Client has no Final data.")}.bind(this)})},drawFinal:function(e){let t=[JSON.stringify(["キャリア採用数","女性管理職比率"]),JSON.stringify(["女性管理職比率","社員の定着率"]),JSON.stringify(["社員の定着率","特許出願件数"]),JSON.stringify(["特許出願件数","ROE"]),JSON.stringify(["Industrial waste recycling rate","Number of press releases"]),JSON.stringify(["Number of press releases","Number of customers in open factory"]),JSON.stringify(["Number of customers in open factory","Sales amount"]),JSON.stringify(["Sales amount","PBR"]),JSON.stringify(["Sales amount","ROE"])];E=true;D.oData.linetmp=[];D.oData.lines=[];let a=this.getView().byId("ID_Green").getSelected();let n=this.getView().byId("ID_Grey").getSelected();let i=this.getView().byId("ID_Black").getSelected();let o=this.getView().byId("ID_Blue").getSelected();let s=e.length;let l=e;l=[];for(let l=0;l<s;l++){let s=e[l];let E=s.SOURCE.toUpperCase();let S=s.INDSOURCE;let I=s.DESTINATION.toUpperCase();let c=s.INDDEST;let T=s.RELATIONSHIP;let N=b;let d=s.AREA;let h=s.DESAREA;for(var r=0;r<D.oData.lines.length;r++){if(D.oData.lines[r].SOURCE.toUpperCase()==E.concat(S).toUpperCase()&&D.oData.lines[r].DESTINATION.toUpperCase()==I.concat(c).toUpperCase()){D.oData.lines.splice(r,1);break}}for(var u=0;u<D.oData.lines.length;u++){if(D.oData.lines[u].SOURCE.toUpperCase()==E.toUpperCase()&&D.oData.lines[u].DESTINATION.toUpperCase()==I.toUpperCase()){D.oData.lines.splice(u,1);break}}let g=false;for(var p=0;p<D.oData.final.length;p++){let e=D.oData.final[p];if(e.SOURCE.toUpperCase()==E&&e.INDSOURCE==S&&e.DESTINATION.toUpperCase()==I&&e.INDDEST==c&&e.NEW_FLAG.toUpperCase()=="O"){D.oData.lines.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"ReleventIndicator",lineType:"Dashed"});D.oData.lines.push({SOURCE:E,DESTINATION:I,status:"ReleventNode",lineType:"Solid"});g=true;break}}if(g==true){return}if(e[l].RELATIONSHIP=="O"||e[l].RELATIONSHIP=="o"){if(S!=""&&c!=""){if(!t.includes(JSON.stringify([S,c]))){if(i==true){D.oData.lines.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"DemonReleInd",lineType:"Solid"})}D.oData.linetmp.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"DemonReleInd",lineType:"Solid"})}else{D.oData.lines.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"ReleventIndicator",lineType:"Solid"})}}if(E!=""&&I!=""){if(a==true){D.oData.lines.push({SOURCE:E,DESTINATION:I,status:"DemonReleNode",lineType:"Solid"});D.oData.linetmp.push({SOURCE:E,DESTINATION:I,status:"DemonReleNode",lineType:"Solid"})}else{D.oData.lines.push({SOURCE:E,DESTINATION:I,status:"customLine",lineType:"Solid"})}}}else if(e[l].RELATIONSHIP=="x"||e[l].RELATIONSHIP=="X"){if(S!=""&&c!=""){if(!t.includes(JSON.stringify([S,c]))){if(o==true){D.oData.lines.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"NDemonReleInd",lineType:"Dashed"})}D.oData.linetmp.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"NDemonReleInd",lineType:"Dashed"})}else{D.oData.lines.push({SOURCE:E.concat(S),DESTINATION:I.concat(c),status:"customLineIndicator",lineType:"Solid"})}}if(E!=""&&I!=""){if(n==true){D.oData.lines.push({SOURCE:E,DESTINATION:I,status:"NDemonReleNode",lineType:"Dashed"});D.oData.linetmp.push({SOURCE:E,DESTINATION:I,status:"NDemonReleNode",lineType:"Dashed"})}else{D.oData.lines.push({SOURCE:E,DESTINATION:I,status:"customLine",lineType:"Solid"})}}}else{var f=false;for(let e=0;e<D.oData.linetmp.length;e++){if(D.oData.linetmp[e].SOURCE==E&&D.oData.linetmp[e].DESTINATION==I){D.oData.lines.push({SOURCE:E,DESTINATION:I,status:D.oData.linetmp[e].status,lineType:D.oData.linetmp[e].lineType});f=true;break}}if(f==false){D.oData.lines.push({SOURCE:E,DESTINATION:I,status:"customLine",lineType:"Solid"})}}}D.refresh();console.log(D)}});return H});
//# sourceMappingURL=NetworkGraph.controller.js.map